{% extends "main/base.html" %}
{% load staticfiles %}
{% load humanize %}
{% load to_int %}
{% load get_username %}

{% block title %} 오픈아레나:{{ tournament.tournament_name }} {% endblock %}
{% block head %}
    <link rel="stylesheet" href="{% static 'css/participation.css' %}">
    <link rel="stylesheet" href="{% static 'css/custom_kyoungin.css' %}">
    <!-- A JavaScript event calendar -->
    <link rel='stylesheet' href="{% static 'css/fullcalendar.min.css' %}">
{% endblock %}
{% block content %}
    <div class="block-b">
        <div class="com_header" style="background:url({{ tournament.cover_image }}) center center no-repeat; background-size: cover;">
            <div class="com_empty">
            </div>
            <div class="com_header_inner">
                <div class="container">
                    <!--프로필칸-->
                    <div class="col-sm-3 col-md-2 col-md-offset-1 hidden-xs" >
                        <div class="com_profile" style="background: url({{ tournament.logo_image }}); background-size: contain;"></div>
                    </div>
                    <!--대회설명-->
                    <div class="col-sm-6 col-md-6 col-xs-12 ">
                        <div class="com_title">{{ tournament.tournament_name }}</div><br/>
                        <p class="com_subtitle hidden-xs">{{ tournament.tournament_summary|safe }}</p>
                    </div>
                    <!--후원/참가-->
                    <div class="col-sm-3 col-md-3 col-xs-12 ">
                        <ul class="com_mainbox">
                            <li class="">
                                {% if tournament.participation == 'yes' %}
                                    {% if tournament_finish == 'finished' %}
                                        <div class="center">
                                            <button disabled="disabled" id="participation" name="participation" class="btn btn-primary center-block" data-toggle="modal" data-target="#participationModal">대회 종료</button>
                                        </div>
                                    {% else %}
                                        {% if participation_finish == 'finished' %}
                                            <div class="center">
                                                <button disabled="disabled" id="participation" name="participation" class="btn btn-primary center-block" data-toggle="modal" data-target="#participationModal">참가 마감</button>
                                            </div>
                                        {% else %}
                                            {% if participation_exist == 'exist' %}
                                                {% if tournament.participation_checkin != 'no' and tournament.participation_checkin != '-' %}
                                                    {% if checkin_start == 'yes' %}
                                                        {% if participation_userinfo.checkin == '확인' %}
                                                            <div class="center">
                                                                <button disabled="disabled" id="participation" name="participation" class="btn btn-primary center-block">체크인 완료</button>
                                                            </div>
                                                        {% else %}
                                                            <div class="center">
                                                                <button id="participation" name="participation" class="btn btn-primary center-block participation_checkin">체크인 시작</button>
                                                            </div>
                                                        {% endif %}
                                                    {% else %}
                                                        <div class="center">
                                                            <button disabled="disabled" id="participation" name="participation" class="btn btn-primary center-block" data-toggle="modal" data-target="#participationModal">체크인 미시작</button>
                                                        </div>
                                                    {% endif %}
                                                {% else %}
                                                    <div class="center">
                                                        <button disabled="disabled" id="participation" name="participation" class="btn btn-primary center-block" data-toggle="modal" data-target="#participationModal">참가 완료</button>
                                                    </div>
                                                {% endif %}
                                            {% else %}
                                                <div class="center">
                                                    <button id="participation" name="participation" class="btn btn-primary center-block" data-toggle="modal" data-target="#participationModal">참가 신청</button>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}
                                {% else %}
                                    {% if participation_finish == 'finished' %}
                                        <div class="center">
                                            <button disabled="disabled" id="participation" name="participation" class="btn btn-primary center-block">참가 마감</button>
                                        </div>
                                    {% else %}
                                        {% if tournament.participation_custom_url != 'no' and tournament.participation_custom_url != '-' %}
                                            <div class="center">
                                                <button id="participation" name="participation" class="btn btn-primary center-block" onclick="window.open('{{ tournament.participation_custom_url }}');">참가 링크</button>
                                            </div>
                                        {% else %}
                                            <div class="center">
                                                <button disabled="disabled" id="participation" name="participation" class="btn btn-primary center-block" data-toggle="modal" data-target="#participationModal">참가 불가</button>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                                <div class="hidden-xs" style="height: 20px"></div>
                                {% if tournament.funding == 'yes' %}
                                    {% if funding_finish == 'finished' %}
                                        <div class="center">
                                            <button disabled="disabled" id="funding" name="funding" class="btn btn-primary center-block" data-toggle="modal" data-target="#fundingModal">기부 마감</button>
                                        </div>
                                    {% else %}

                                        {% if has_funded == 'yes' %}
                                            <div class="center">
                                                <button id="funding" name="funding" class="btn btn-primary center-block" data-toggle="modal" data-target="#donationModal">추가 기부</button>
                                            </div>
                                        {% else %}
                                            <div class="center">
                                                <button id="funding" name="funding" class="btn btn-primary center-block" data-toggle="modal" data-target="#donationModal">기부 하기</button>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                {% else %}
                                    <div class="center">
                                        <button disabled="disabled" id="funding" name="funding" class="btn btn-primary center-block" data-toggle="modal" data-target="#fundingModal">기부 불가</button>
                                    </div>
                                {% endif %}
                                <div class="hidden-xs" style="height: 20px"></div>
                                {% if tournament.streaming == 'yes' %}
                                    <div class="center">
                                        <button id="streaming" name="streaming" class="btn btn-primary center-block" data-toggle="modal" data-target="#streamingModal">방송 보기</button>
                                    </div>
                                {% else %}
                                    <div class="center">
                                        <button disabled="disabled" id="streaming" name="streaming" class="btn btn-primary center-block" data-toggle="modal" data-target="#streamingModal">방송 안함</button>
                                    </div>
                                {% endif %}
                            </li>
                        </ul>
                    </div>

                    <!--상금바-->
                    <div class="col-sm-10 col-md-10 col-xs-10 col-md-offset-1 ">
                        <h4 id="comma1" class="com_title">
                            {% if funding %}
                                총 {{ total_amount|intcomma }}원 후원 해주셨습니다.
                            {% else %}
                                총 0원 후원 해주셨습니다.
                            {% endif %}
                        </h4>
                        <p class="com_subtitle">후원 목표 | {{ tournament.funding_goal|intcomma }}원</p>
                        <!--
                        <div class="com_white_bar">
                            <div class="com_orange_bar"></div>
                        </div>
                        -->
                    </div>
                </div>
            </div>
        </div>
        <div class="com_mid">
            <!--competition list-->
            <div class="btn-pref btn-group btn-group-justified btn-group-lg" role="group" aria-label="...">
                <!-- 대회 소개 -->
                <div class="btn-group" role="group">
                    <button type="button" id="stars" class="btn btn-primary no_border" href="#com_tab1" data-toggle="tab">
                        <span class="list_btn">대회 소개</span>
                    </button>
                </div>
                <!-- 대회 게시판 -->
                <div class="btn-group" role="group">
                    <button type="button" id="following" class="btn btn-custom no_border" href="#com_tab2" data-toggle="tab">
                        <span class="list_btn">게시판</span>
                    </button>
                </div>
                <!-- 대진표 -->
                <div class="btn-group" role="group">
                    <button type="button" id="following" class="btn btn-custom no_border" href="#com_tab3" data-toggle="tab">
                        <span class="list_btn">대진표 / 참가자</span>
                    </button>
                </div>
                <!-- 후원자 명단 -->
                {% if tournament.funding == 'yes' %}
                    <div class="btn-group" role="group">
                        <button type="button" id="following" class="btn btn-custom no_border" href="#com_tab4" data-toggle="tab">
                            <span class="list_btn">후원자 명단</span>
                        </button>
                    </div>
                {% endif %}
            </div>

            <!--competition content-->
            <div class="tab-content">
                <!--competition content 1-->
                <div class="tab-pane fade in active" id="com_tab1">
                    <div class="com_intro">
                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
                            <div style="overflow: hidden; clear: both;">
                                <h4 style="color: #f7941e">• 대회 캘린더</h4>
                                <div class="com_intro_now hover_div">
                                    <div class="reset-this" id="calendar"></div>
                                </div>
                            </div>
                            <div style="overflow: hidden; clear: both;">
                                <h4 style="color: #f7941e">• 대회 소개 및 규칙</h4>
                                <div class="com_intro_now hover_div">
                                    <div id="description" class="summernote_description">{{ tournament.tournament_rule|safe }}</div>
                                    <hr/>
                                    <p style="color: #ff9900">•환불 규정</p>
                                    <p>1. 펀딩 마감 이후 환불이 불가능한 점 양해 부탁드립니다.</p>
                                    <p>2. 대회가 중단된 경우에는 결제 수수료를 제외한 금액이 대회 중단 확정 후 3일 이내로 환불해드립니다.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div>
                                <h4 style="color: #f7941e">• 대회 정보</h4>
                                <div class="container com_intro_now hover_div">
                                    <div class="com_into_small">대회 시작</div>
                                    <div class="com_into_small"><span class="com_into_big">{{ tournament.tournament_starttime }}</span> 일</div>
                                    <br/>
                                    <div class="com_into_small">대회 종료</div>
                                    <div class="com_into_small"><span class="com_into_big">{{ tournament.tournament_endtime }}</span> 일</div>
                                    {% if tournament.participation == 'yes' %}
                                        <hr/>
                                        <div class="com_into_small">참가자 수</div>
                                        {% if participation %}
                                            <div class="com_into_small"><span class="com_into_big">{{ participation.count }}</span> 명</div>
                                        {% else %}
                                            <div class="com_into_small"><span class="com_into_big">0</span> 명</div><br>
                                        {% endif %}
                                        <br/>
                                        <div class="com_into_small">참가 마감</div>
                                        <div class="com_into_small"><span class="com_into_big">{{ tournament.participation_endtime }}</span> 일</div>
                                        {% if tournament.participation_checkin != 'no' and tournament.participation_checkin != '-'  %}
                                            <br/>
                                            <div class="com_into_small">체크인 시간</div>
                                            <div class="com_into_small">
                                                <span class="com_into_big" style="color: yellowgreen">
                                                    대회 시작 {{ tournament.participation_checkin }}
                                                </span> 전부터
                                            </div>
                                        {% endif %}

                                    {% else %}
                                        <hr/>
                                        <div class="com_into_small">참가자</div>
                                        <div class="com_into_small"><span class="com_into_big" style="color: yellowgreen">참가자를 받지 않는 대회</span></div>
                                    {% endif %}

                                    {% if tournament.funding == 'yes' %}
                                        <hr/>
                                        {% if funding %}
                                            <div class="com_into_small">후원자 수</div>
                                            <div class="com_into_small"><span class="com_into_big">{{ funding|length }}</span> 명</div><br>
                                            <div class="com_into_small">후원 상금</div>
                                            <div class="com_into_small"><span class="com_into_big">{{ total_amount|intcomma }}</span> 원</div><br>
                                        {% else %}
                                            <div class="com_into_small">후원자 수</div>
                                            <div class="com_into_small"><span class="com_into_big">0</span> 명</div><br>
                                            <div class="com_into_small">후원 상금</div>
                                            <div class="com_into_small"><span class="com_into_big">0</span> 원</div><br>
                                        {% endif %}
                                    {% endif %}

                                    <div class="com_into_small">
                                        <!-- Go to www.addthis.com/dashboard to customize your tools -->
                                        <div class="addthis_inline_share_toolbox"></div>
                                    </div>
                                </div>
                            </div>
                            <div style="overflow: hidden; clear: both;">
                                {% if tournament.reward == 'yes' %}
                                    <div style="padding: 0;">
                                        <h4 style="color: #f7941e;">• 후원 보상</h4>
                                        <div class="com_intro_now hover_div">
                                            {% for rn in reward_number %}
                                                {% for rs in reward_spec %}
                                                    {% if forloop.counter == forloop.parentloop.counter %}
                                                        <div class="com_into_small">{{ rn|intcomma }}원 이상 후원 시</div>
                                                        <div class="com_into_small"><span id="reward_spec" class="com_into_big">{{ rs }}</span></div><br>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                            <div style="overflow: hidden; clear: both;">
                                {% if tournament.promise == 'yes' %}
                                    <div style="padding: 0;">
                                        <h4 style="color: #f7941e">• 후원 공약</h4>
                                        <div class="com_intro_now hover_div">
                                            {% for pn in promise_number %}
                                                {% for ps in promise_spec %}
                                                    {% if forloop.counter == forloop.parentloop.counter %}
                                                        <div class="com_into_small">{{ pn|intcomma }}원 이상 후원 시</div>
                                                        <div class="com_into_small"><span id="promise_spec" class="com_into_big">{{ ps }}</span></div><br>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                            <div style="overflow: hidden; clear: both;">
                                <h4 style="color: #f7941e;">• 크리에이터 정보</h4>
                                <div class="container com_intro_now hover_div">
                                    <div class="com_into_small">개최자</div>
                                    <div class="com_into_small"><span class="com_into_big">{{ tournament.profile_name }}</span></div><br>
                                    <div class="com_into_small">소개</div>
                                    <div class="com_into_small"><span class="com_into_big">{{ tournament.profile_introduction|safe }}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--competition content 2-->
                <div class="tab-pane fade in" id="com_tab2">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">
                        <div style="overflow:hidden; padding-top: 20px;">
                            <div style="display: inline-block;">
                                <h4 style="color: #f7941e">• 공지 사항 <span style="font-size: 14px; color: white;">대회 개최자 전용</span></h4>
                            </div>
                            {% if is_creator == 'yes' %}
                                <div style="display: inline-block;">
                                    <button id="edit_notice" class="btn btn-default" type="button" value="업데이트">수정하기</button>
                                </div>
                            {% endif %}
                        </div>
                        <div class="com_intro_desp hover_div" style="margin-top: 5px;">
                            <div id="summernote_notice" class="summernote">{{ tournament.notice|safe }}</div>
                        </div>
                        <div style="overflow:hidden; padding-top: 20px;">
                            <div style="display: inline-block;">
                                <h4 style="color: #f7941e">• 게시판 목록 : </h4>
                            </div>
                            <div style="display: inline-block;">
                                <ul class="pager" style="margin: 0; display: inline-block;">
                                    <li class="free_board">
                                        <a id="free_board" class="" href="javascript:void(0)" style="background: #ff9900; color: #fff; border-color: #ff9900">
                                            자유 게시판
                                        </a>
                                    </li>
                                    <!--
                                    <li class="participation_board">
                                        <a id="participation_board" class="hover_a" href="javascript:void(0)" style="background: #1a1a1a; color: #fff">
                                            참가자 게시판
                                        </a>
                                    </li>
                                    <li class="video_board">
                                        <a id="video_board" class="hover_a" href="javascript:void(0)" style="background: #1a1a1a; color: #fff">
                                            영상 게시판
                                        </a>
                                    </li>
                                    -->
                                </ul>
                            </div>
                        </div>
                        <div id="div_free_board" class="com_intro_desp hover_div" style="margin-top: 5px;">
                            <div id="freeboard">
                                {% if comment_tree %}
                                    <ul id="commenters">
                                        {% for c in comment_tree %}
                                            <li id="{{ c.id }}" class="" style="margin-left:{{c.depth|add:c.depth}}em;">
                                                <h5 style="border-top: 1px solid #eee"></h5>
                                                <h5>{{ c.content }}</h5>
                                                <h5 class="poster" style="color: #D1D1DD">{{ c.username }} 님 - {{ c.date }}</h5>
                                                <h5><a href="javascript:return false" class="reply">댓글 달기</a></h5>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <h5>첫번째 댓글을 등록해보세요.</h5><br/>
                                {% endif %}
                            </div>

                            <form id="comment_form" method="POST">{% csrf_token %}
                                <br/>
                                <input type="hidden" class="form-control" id="purpose" name="purpose" value="comment">
                                <input type="hidden" class="parent" id="parent" name="parent">
                                <input type="hidden" class="form-control" id="tournament_id" name="tournament_id" value="{{ tournament.id }}">
                                <input type="hidden" class="form-control" id="tournament_name" name="tournament_name" value="{{ tournament.tournament_name }}">
                                {% if request.user.is_authenticated %}
                                    <input id="content" name="content" class="form-control com_donate_desp" placeholder="댓글을 입력해주세요."/>
                                {% else %}
                                    <input disabled="disabled" id="content" name="content" class="form-control com_donate_desp" placeholder="로그인 후 자유롭게 댓글을 입력해주세요."/>
                                {% endif %}
                                <button type="submit" class="btn btn-primary com_donate_enroll">등록</button>
                            </form>
                        </div>
                        <div id="div_participation_board" class="com_intro_desp hover_div" style="margin-top: 5px;">
                            <div id="chatboard">
                                <ul id="msg-list" class="list-group">
                                    {% include 'main/functions/messages.html' %}
                                    <script>
                                        var chatlist = document.getElementById('msg-list-div');
                                        chatlist.scrollTop = chatlist.scrollHeight;
                                    </script>
                                </ul>
                                <br/>
                                <form id="chat_form" method="POST">{% csrf_token %}
                                    <input type="text" id="chat-msg" name="chat-msg" class="form-control com_donate_desp" placeholder="로그인, 대회참가 후 대화를 시작해보세요."/>
                                    <button type="submit" id="send" class="btn btn-primary com_donate_enroll">등록</button>
                                </form>
                            </div>
                        </div>
                        <div id="div_video_board" class="com_intro_desp hover_div" style="margin-top: 5px;">

                        </div>
                    </div>
                </div>

                <!--competition content 3-->
                <div class="tab-pane fade in" id="com_tab3">

                    <div class="row">
                        <div class="row" style="overflow:hidden; padding-top: 20px;">
                            <div style="display: inline-block;">
                                <h4 style="color: #f7941e">
                                    {% if tournament.participation == 'yes' %}
                                        • 대진표
                                    {% else %}
                                        • 수동 대진표 구성 <span style="color: white; font-size: 14px;">대회 개최자 전용</span>
                                    {% endif %}

                                    {% if is_creator == 'yes' %}
                                        {% if tournament.challonge_start == 'yes' %}
                                            <button id="challonge_reset" class="btn btn-default">대진표 기능 초기화</button>
                                        {% else %}
                                            <button id="challonge_start" class="btn btn-default">대진표 기능 시작</button>
                                        {% endif %}
                                    {% endif %}
                                </h4>
                                <h5>참가자가 2명 이상이 되어야 대진표가 구성됩니다.</h5>
                            </div>
                        </div>
                        <div class="row com_intro_desp hover_div" style="margin-top: 5px;">
                            <iframe src="http://challonge.com/{{ tournament.challonge_url }}/module" width="100%" height="500" frameborder="0" scrolling="auto" allowtransparency="true"></iframe>
                        </div>
                        {% if tournament.challonge_start == 'yes' %}
                            {% if is_creator == 'yes' %}
                                <br/>
                                <div class="row">
                                    <h4 style="color: #f7941e">
                                        • 대회 매치 관리
                                        <span style="color: white; font-size: 14px;">대회 개최자 전용</span>
                                    </h4>
                                    <h5>대회 매치 결과를 입력해주시면 대진표에 반영됩니다.</h5>
                                </div>
                                <div class="panel panel-default panel-table">
                                    <div class="panel-body">
                                        <table class="table table-striped table-list">
                                            <thead>
                                            <tr>
                                                <th>매치 번호</th>
                                                <th>플레이어 1</th>
                                                <th></th>
                                                <th>플레이어 2</th>
                                                <th>스코어</th>
                                                <th>상태</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for cml in challonge_match_list %}
                                                <tr>
                                                    <td>{{ cml.match.suggested_play_order }}</td>
                                                    {% if cml.match.state == 'complete' %}
                                                        {% if cml.match.winner_id == cml.match.player1_id %}
                                                            <td style="color: greenyellow">{{ cml.match.player1_id|get_username }} (승리)</td>
                                                        {% elif cml.match.loser_id == cml.match.player1_id %}
                                                            <td style="color: orangered">{{ cml.match.player1_id|get_username }} (패배)</td>
                                                        {% else %}
                                                            <td style="color: gray">{{ cml.match.player1_id|get_username }} (무승부)</td>
                                                        {% endif %}
                                                        <td>vs.</td>
                                                        {% if cml.match.winner_id == cml.match.player2_id %}
                                                            <td style="color: greenyellow">{{ cml.match.player2_id|get_username }} (승리)</td>
                                                        {% elif cml.match.loser_id == cml.match.player2_id %}
                                                            <td style="color: orangered">{{ cml.match.player2_id|get_username }} (패배)</td>
                                                        {% else %}
                                                            <td style="color: gray">{{ cml.match.player2_id|get_username }} (무승부)</td>
                                                        {% endif %}
                                                        <td>{{ cml.match.scores_csv }}</td>
                                                        <td><button disabled="disabled" id="" class="btn btn-default">매치 완료</button></td>
                                                    {% elif cml.match.state == 'open' %}
                                                        <td>{{ cml.match.player1_id|get_username }}</td>
                                                        <td>vs.</td>
                                                        <td>{{ cml.match.player2_id|get_username }}</td>
                                                        <td style="color: greenyellow">매치 진행중</td>
                                                        <td><button id="button_matchModal" class="btn btn-default" data-toggle="modal" data-target="#matchModal" data-player1-id="{{ cml.match.player1_id }}" data-player1-username="{{ cml.match.player1_id|get_username }}" data-player2-id="{{ cml.match.player2_id }}" data-player2-username="{{ cml.match.player2_id|get_username }}" data-match-id="{{ cml.match.id }}">매치 결과 제출</button></td>
                                                    {% elif cml.match.state == 'pending' %}
                                                        <td>{{ cml.match.player1_id|get_username }}</td>
                                                        <td>vs.</td>
                                                        <td>{{ cml.match.player2_id|get_username }}</td>
                                                        <td>-</td>
                                                        <td><button disabled="disabled" id="" class="btn btn-default">매치 대기중</button></td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>

                    <div class="row">
                        <div style="overflow:hidden; padding-top: 20px;">
                            <div style="display: inline-block;">
                                <h4>
                                    {% if tournament.participation == 'yes' %}
                                        <a class="donator_title">• 참가자 수 : </a>
                                    {% else %}
                                        <a class="donator_title">• 수동 참가자 구성 : </a>
                                    {% endif %}

                                    {% if participation %}
                                        <a style="color: white">{{ participation.count }} 명</a>
                                    {% else %}
                                        <a style="color: white">0명</a>
                                    {% endif %}

                                    {% if tournament.participation != 'yes' %}
                                        <span style="color: white; font-size: 14px;">대회 개최자 전용</span>
                                    {% endif %}

                                    {% if is_creator == 'yes' %}
                                        {% if tournament_finish != 'finished' %}
                                            {% if tournament.challonge_start == 'yes' %}
                                                <button disabled="disabled" id="participation_add" class="btn btn-default">참가자 수동 추가</button>
                                            {% else %}
                                                {% if tournament.participation == 'yes' %}
                                                    <button id="participation_add" class="btn btn-default" data-toggle="modal" data-target="#participationManualModal">참가자 수동 추가</button>
                                                {% else %}
                                                    <button id="participation_add" class="btn btn-default" data-toggle="modal" data-target="#participationNoModal">참가자 수동 추가</button>
                                                {% endif %}
                                            {% endif %}
                                        {% else %}
                                            <button disabled="disabled" id="participation_add" class="btn btn-default" data-toggle="modal" data-target="#participationNoModal">대회 종료</button>
                                        {% endif %}
                                    {% endif %}
                                </h4>
                                {% if is_creator == 'yes' %}
                                    <h5 style="color: gray">개최자에게만 참가자 세부정보가 보이며, 참가자를 수정/삭제할 수 있습니다.</h5>
                                {% endif %}
                            </div>
                        </div>

                        {% if tournament.participation == 'yes' %}
                            <div class="panel panel-default panel-table">
                                <div class="panel-body">
                                    <table class="table table-striped table-list">
                                        <thead>
                                        <tr>
                                            <th>시드 번호</th>
                                            <th>오픈아레나 닉네임</th>
                                            {% if is_creator == 'yes' %}
                                                {% for pt in participation_template %}
                                                    <th style="color: gray">{{ pt }}</th>
                                                {% endfor %}
                                            {% endif %}
                                            {% if tournament.participation_checkin != 'no' and tournament.participation_checkin != '-' %}
                                                <th style="color: yellowgreen">체크인</th>
                                            {% endif %}
                                            {% if is_creator == 'yes' %}
                                                <th style="color: #ff9900">수정</th>
                                                <th style="color: #ff9900">삭제</th>
                                            {% endif %}
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% if participation %}
                                            {% for p in participation %}
                                                <tr>
                                                    {% if forloop.counter > tournament.participation_number|to_int %}
                                                        {% if p.seed == '' %}
                                                            <td style="color: gray">{{ forloop.counter }} (대기자)</td>
                                                        {% else %}
                                                            <td style="color: gray">{{ p.seed }} (대기자)</td>
                                                        {% endif %}
                                                    {% else %}
                                                        {% if p.seed == '' %}
                                                            <td>{{ forloop.counter }}</td>
                                                        {% else %}
                                                            <td>{{ p.seed }}</td>
                                                        {% endif %}
                                                    {% endif %}
                                                    <td
                                                            {% if forloop.counter > tournament.participation_number|to_int %}
                                                                style="color: gray"
                                                            {% endif %}
                                                    >
                                                        {% if p.username != "" and p.username != "-" %}
                                                            {{ p.username }}
                                                            {% if user.is_authenticated %}
                                                                {% if p.username == request.user.username %}
                                                                    {% if tournament_start == 'yes' %}
                                                                        <a href="javascript: alert('대회가 시작되어 수정이 불가능합니다. 개최자에게 문의해주세요.');" name="{{ p.id }}">&nbsp;<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                                                                        <a href="javascript: alert('대회가 시작되어 삭제가 불가능합니다. 개최자에게 문의해주세요.');" name="{{ p.id }}">&nbsp;<span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                                                                    {% else %}
                                                                        <a href="javascript: void(0)" class="participation_edit_self" name="{{ p.id }}" data-toggle="modal" data-target="#participationSelfModal">&nbsp;<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                                                                        <a hidden="hidden" href="javascript: void(0)" class="participation_save" name="{{ p.id }}">&nbsp;<span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span></a>
                                                                        <a href="javascript: void(0)" class="participation_delete" name="{{ p.id }}">&nbsp;<span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% endif %}
                                                        {% else %}
                                                            {{ p.dummy_username }}
                                                        {% endif %}
                                                    </td>
                                                    {% if is_creator == 'yes' %}
                                                        {% for pt in p.get_input_list %}
                                                            {% if 'http' in pt %}
                                                                <td><a href="{{ pt }}" target="_blank" style="color: gray; text-decoration: underline">파일 링크 열기</a></td>
                                                                <input class="form-control participation_edit_input" type="hidden" value="{{ pt }}"/>
                                                            {% else %}
                                                                <td class="participation_edit_td" style="color: gray">{{ pt }}</td>
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% endif %}
                                                    {% if tournament.participation_checkin != 'no' and tournament.participation_checkin != '-' %}
                                                        {% if p.checkin == '확인' %}
                                                            <td style="color: yellowgreen"><span class="glyphicon glyphicon-ok"></span></td>
                                                        {% else %}
                                                            <td style="color: yellowgreen"></td>
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if is_creator == 'yes' %}
                                                        <td>
                                                            <a href="javascript: void(0)" class="participation_edit" name="{{ p.id }}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                                                            <a hidden="hidden" href="javascript: void(0)" class="participation_save" name="{{ p.id }}"><span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span></a>
                                                        </td>
                                                        <td><a href="javascript: void(0)" class="participation_delete" name="{{ p.id }}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a></td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        {% else %}
                            <div class="panel panel-default panel-table">
                                <div class="panel-body">
                                    <table class="table table-striped table-list">
                                        <thead>
                                        <tr>
                                            <th>시드 번호</th>
                                            <th>참가자 닉네임</th>
                                            {% if is_creator == 'yes' %}
                                                <th style="color: gray">참가자 정보</th>
                                                <th style="color: #ff9900">수정</th>
                                                <th style="color: #ff9900">삭제</th>
                                            {% endif %}
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% if participation %}
                                            {% for p in participation %}
                                                <tr>
                                                    <td>{{ p.seed }}</td>
                                                    <td>{{ p.dummy_username }}</td>
                                                    {% if is_creator == 'yes' %}
                                                        {% for pt in p.get_input_list %}
                                                            <td class="participation_edit_td" style="color: gray">{{ pt }}</td>
                                                        {% endfor %}
                                                        <td>
                                                            <a href="javascript: void(0)" class="participation_edit" name="{{ p.id }}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                                                            <a hidden="hidden" href="javascript: void(0)" class="participation_save" name="{{ p.id }}"><span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span></a>
                                                        </td>
                                                        <td>
                                                            {% if tournament.challonge_start == 'yes' %}
                                                                <a href="javascript: alert('대진표 기능 시작 후에는 참가자를 삭제할 수 없습니다. 대진표 기능 초기화 후 참가자를 삭제해주세요.');" name="{{ p.id }}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                                                            {% else %}
                                                                <a href="javascript: void(0)" class="participation_delete" name="{{ p.id }}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
                                                            {% endif %}
                                                        </td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        {% endif %}
                    </div>

                </div>

                <!--competition content 4-->
                {% if tournament.funding == 'yes' %}
                    <div class="tab-pane fade in" id="com_tab4">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div style="overflow:hidden; padding-top: 20px;">
                                <div style="display: inline-block;">
                                    <h4>
                                        <a class="donator_title">• 후원자 수 : </a>
                                        {% if funding %}
                                            <a style="color: white">{{ funding|length }} 명</a>
                                        {% else %}
                                            <a style="color: white">0 명</a>
                                        {% endif %}
                                    </h4>
                                </div>
                            </div>

                            <div class="panel panel-default panel-table">
                                <div class="panel-body">
                                    <table class="table table-striped table-list">
                                        <thead>
                                        <tr>
                                            <th>순서</th>
                                            <th>오픈아레나 닉네임</th>
                                            <th style="color: yellowgreen">후원 금액</th>
                                            <!--
                                            <th style="color: #ff9900">보상 혜택</th>
                                            -->
                                            <th>응원 문구</th>
                                            {% if is_creator == 'yes' %}
                                                <th style="color: gray">후원자 연락처</th>
                                            {% endif %}
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% if funding %}
                                            {% for f in funding %}
                                                <tr>
                                                    <td>{{ forloop.counter }}</td>
                                                    <td>{{ f.username }} 님</td>
                                                    <td style="color: yellowgreen">{{ f.amount|intcomma }}원</td>
                                                    <!--
                                                    <td style="color: #ff9900">{{ f.reward }}</td>
                                                    -->
                                                    {% if f.comment == "" %}
                                                        <td>-</td>
                                                    {% else %}
                                                        <td>{{ f.comment }}</td>
                                                    {% endif %}
                                                    {% if is_creator == 'yes' %}
                                                        {% if f.phone == "" %}
                                                            <td style="color: gray">-</td>
                                                        {% else %}
                                                            <td style="color: gray">{{ f.phone }}</td>
                                                        {% endif %}
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!--video content-->
                <div class="tab-pane fade in" id="com_tab6">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="com_intro_desp">
                            <div class="contents_video" >
                                <div class="contents_video_ul"><!--업로드한 동영상-->
                                    <div >
                                        <select class="form-control input-sm control">
                                            <option selected>최신순</option>
                                            <option>조회순</option>
                                            <option>댓글순</option>
                                        </select>
                                        <div class="upload">대회 영상 모음</div>
                                    </div>
                                    <div class="video_bar"></div>
                                    {% if video %}
                                        {% for v in video %}
                                            <iframe class="video_clip" width="300" height="200" src="{{ v.video_url }}" frameborder="0" wmode="Opaque"></iframe>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--competition content-end-->

            <!--participation in-->
            {% if tournament.participation == 'yes' %}
                <div class="modal fade" id="participationModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                <h3 class="modal-title" id="lineModalLabel">대회 참가하기</h3>
                            </div>
                            <div class="modal-body">
                                <!-- content goes here -->
                                <form id="participation_form" method="POST">{% csrf_token %}
                                    <input type="hidden" class="form-control" id="purpose" name="purpose" value="participation">
                                    <input type="hidden" class="form-control" id="tournament_id" name="tournament_id" value="{{ tournament.id }}">
                                    <input type="hidden" class="form-control" id="tournament_name" name="tournament_name" value="{{ tournament.tournament_name }}">
                                    <label style="color: #ff9900;">아래 대회 참가자 양식을 입력해주세요.</label>
                                    {% for ptf in participation_template_format %}
                                        {% for pt in participation_template %}
                                            {% if forloop.counter == forloop.parentloop.counter %}
                                                {% if ptf == 'text' %}
                                                    <div class="form-group">
                                                        <label id="participation_label">{{ forloop.counter }}. {{ pt }}</label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon" id="basic-addon1">입력 항목</span>
                                                            <input required autocomplete="off" class="form-control" name="participation_template[{{ forloop.counter }}]" placeholder="입력해주세요.">
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <div class="form-group">
                                                        <label id="participation_label">{{ forloop.counter }}. {{ pt }}</label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon" id="basic-addon1">파일 제출</span>
                                                            <input autocomplete="off" class="form-control" type="file" name="participation_template[{{ forloop.counter }}]">
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                    {% endfor %}
                                    <button id="participation_submit" type="submit" class="btn btn-primary center-block join_submit">참가 하기</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="participationManualModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                <h3 class="modal-title" id="lineModalLabel">대회 참가하기</h3>
                            </div>
                            <div class="modal-body">
                                <!-- content goes here -->
                                <form id="participationManual_form" method="POST">{% csrf_token %}
                                    <input type="hidden" class="form-control" id="purpose" name="purpose" value="participationManual">
                                    <input type="hidden" class="form-control" id="tournament_id" name="tournament_id" value="{{ tournament.id }}">
                                    <input type="hidden" class="form-control" id="tournament_name" name="tournament_name" value="{{ tournament.tournament_name }}">
                                    <label style="color: #ff9900;">아래 대회 참가자 양식을 입력해주세요.</label>
                                    <div class="form-group">
                                        <label for="dummy_username">• 참가자 닉네임 <span style="color: white;">| 오픈아레나 닉네임 대신 사용됩니다.</span></label>
                                        <div class="input-group">
                                            <span class="input-group-addon" id="basic-addon1">입력 항목</span>
                                            <input required autocomplete="off" class="form-control" id="participation_dummy_username" name="participation_dummy_username" placeholder="입력해주세요.">
                                        </div>
                                    </div>
                                    {% for ptf in participation_template_format %}
                                        {% for pt in participation_template %}
                                            {% if forloop.counter == forloop.parentloop.counter %}
                                                {% if ptf == 'text' %}
                                                    <div class="form-group">
                                                        <label id="participation_label">{{ forloop.counter }}. {{ pt }}</label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon" id="basic-addon1">입력 항목</span>
                                                            <input required autocomplete="off" class="form-control" name="participation_template[{{ forloop.counter }}]" placeholder="입력해주세요.">
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <div class="form-group">
                                                        <label id="participation_label">{{ forloop.counter }}. {{ pt }}</label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon" id="basic-addon1">파일 제출</span>
                                                            <input required autocomplete="off" class="form-control" type="file" name="participation_template[{{ forloop.counter }}]">
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                    {% endfor %}
                                    <button id="participationManual_submit" type="submit" class="btn btn-primary center-block join_submit">참가 하기</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="participationSelfModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                <h3 class="modal-title" id="lineModalLabel">대회 참가하기</h3>
                            </div>
                            <div class="modal-body">
                                <!-- content goes here -->
                                <form id="participation_selfedit_form" method="POST">{% csrf_token %}
                                    <input type="hidden" class="form-control" id="purpose" name="purpose" value="participation_selfedit">
                                    <input type="hidden" class="form-control" id="tournament_id" name="tournament_id" value="{{ tournament.id }}">
                                    <input type="hidden" class="form-control" id="tournament_name" name="tournament_name" value="{{ tournament.tournament_name }}">
                                    <label style="color: #ff9900;">아래 대회 참가자 양식을 수정해주세요.</label>
                                    {% for ptf in participation_template_format %}
                                        {% for pt in participation_template %}
                                            {% if forloop.counter == forloop.parentloop.counter %}
                                                {% if ptf == 'text' %}
                                                    <div class="form-group">
                                                        <label id="participation_label">{{ forloop.counter }}. {{ pt }}</label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon" id="basic-addon1">입력 항목</span>
                                                            <input id="participation_self_template_{{ forloop.conuter }}" required autocomplete="off" class="form-control" name="participation_template[{{ forloop.counter }}]" placeholder="입력해주세요.">
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <div class="form-group">
                                                        <label id="participation_label">{{ forloop.counter }}. {{ pt }}</label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon" id="basic-addon1">파일 제출</span>
                                                            <input id="participation_self_template_{{ forloop.conuter }}" required autocomplete="off" class="form-control" type="file" name="participation_template[{{ forloop.counter }}]">
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                    {% endfor %}
                                    <button id="participation_selfedit_submit" type="submit" class="btn btn-primary center-block join_submit">수정 하기</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="modal fade" id="participationNoModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                <h3 class="modal-title" id="lineModalLabel">참가자 수동 추가</h3>
                            </div>
                            <div class="modal-body">
                                <!-- content goes here -->
                                <form id="participationNo_form" method="POST">{% csrf_token %}
                                    <input type="hidden" class="form-control" id="purpose" name="purpose" value="participationNo">
                                    <input type="hidden" class="form-control" id="tournament_id" name="tournament_id" value="{{ tournament.id }}">
                                    <input type="hidden" class="form-control" id="tournament_name" name="tournament_name" value="{{ tournament.tournament_name }}">
                                    <label style="color: #ff9900;">아래 대회 참가자 양식을 입력해주세요.</label>
                                    <div class="form-group">
                                        <label for="dummy_username">• 참가자 닉네임 <span style="color: white;">| 오픈아레나 닉네임 대신 사용됩니다.</span></label>
                                        <div class="input-group">
                                            <span class="input-group-addon" id="basic-addon1">입력 항목</span>
                                            <input required autocomplete="off" class="form-control" id="participation_dummy_username" name="participation_dummy_username" placeholder="입력해주세요.">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="dummy_username">• 참가자 정보 <span style="color: white;">| 참가자 관련 정보를 적어주세요.(선택사항)</span></label>
                                        <div class="input-group">
                                            <span class="input-group-addon" id="basic-addon1">입력 항목</span>
                                            <input autocomplete="off" class="form-control" id="participation_input" name="participation_input[]" placeholder="입력해주세요.">
                                        </div>
                                    </div>
                                    <button id="participationNo_submit" type="submit" class="btn btn-primary center-block join_submit">참가 하기</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!--donate-->
            {% if tournament.funding == 'yes' %}
                <div class="modal fade" id="donationModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                <h3 class="modal-title" id="lineModalLabel">기부 하기</h3>
                            </div>
                            <div class="modal-body" style="text-align:center;">
                                <!-- content goes here -->
                                <img src="https://s3.ap-northeast-2.amazonaws.com/openarena/admin/images/donation_toss_qrcode.png" alt="toss qrcode" style="width: 50%; display:block; margin-left: auto; margin-right: auto;">
                                <br/>
                                <p>PC는 QR코드 스캔, 모바일은 후원 링크: <a href="http://get.toss.im/RErc/w9CitensPD">http://get.toss.im/RErc/w9CitensPD</a>를 이용해주세요.</p>
                                <p>다른 방식의 후원을 원하시는 분은 <a href="http://plus.kakao.com/home/@%EC%98%A4%ED%94%88%EC%95%84%EB%A0%88%EB%82%98">카카오톡 문의</a>를 통해 문의해주세요.</p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="modal fade" id="fundingModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                <h3 class="modal-title" id="lineModalLabel">대회 후원하기</h3>
                            </div>
                            <div class="modal-body">
                                <!-- content goes here -->
                                <form id="funding_form" method="POST">{% csrf_token %}
                                    <input type="hidden" class="form-control" id="purpose" name="purpose" value="funding">
                                    <input type="hidden" class="form-control" id="tournament_id" name="tournament_id" value="{{ tournament.id }}">
                                    <input type="hidden" class="form-control" id="tournament_name" name="tournament_name" value="{{ tournament.tournament_name }}">
                                    <div class="form-group">
                                        <label style="color: #ff9900;">후원하실 금액을 선택해주세요. <span style="color: white;">Toss API로 결제가 진행됩니다.</span></label>
                                        <h5>금액 직접 입력 시 1,000원 이상부터 후원 가능합니다.</h5>
                                        <select id="funding_amount" name="funding_amount" class="form-control">
                                            <option value="1000">1,000원</option>
                                            <option value="3000">3,000원</option>
                                            <option value="5000">5,000원</option>
                                            <option value="10000">10,000원</option>
                                            <option value="20000">20,000원</option>
                                            <option value="50000">50,000원</option>
                                            <option value="etc">금액 직접 입력</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="div_funding_amount_etc" style="display: none;">
                                        <div class="input-group spinner spinner_funding_amount" style="width: 100%;">
                                            <span class="input-group-addon">￦</span>
                                            <input required disabled="disabled" type="text" class="form-control" id="funding_amount_etc" name="funding_amount_etc" value="1000">
                                            <div class="input-group-btn-vertical">
                                                <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                                <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    {% if tournament.reward == 'yes' or tournament.promise == 'yes' %}
                                        <div class="form-group">
                                            <label for="exampleInputPassword1">후원 보상을 받으실 경우 연락처를 입력해주세요.(선택 사항)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon" id="basic-addon1">입력 항목</span>
                                                <input type="text" class="form-control" id="funding_phone" name="funding_phone" placeholder="예) 010-1234-5678">
                                            </div>
                                        </div>
                                    {% endif %}
                                    <div class="form-group">
                                        <label for="exampleInputPassword1">대회 응원 문구를 적어주세요.(선택 사항)</label>
                                        <div class="input-group">
                                            <span class="input-group-addon" id="basic-addon1">입력 항목</span>
                                            <input type="text" class="form-control" id="funding_comment" name="funding_comment" placeholder="예) 재밌는 대회 기대하겠습니다!">
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary center-block join_submit">후원 하기</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!--streaming URL-->
            {% if tournament.streaming == 'yes' %}
                <div class="modal fade" id="streamingModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                <h3 class="modal-title" id="lineModalLabel">방송 보러가기</h3>
                            </div>
                            <div class="modal-body">
                                <!-- content goes here -->
                                <div class="form-group">
                                    <label for="exampleInputPassword1">방송을 시청하실 스트리밍 사이트를 선택해주세요.</label>
                                </div>
                                {% for ss in streaming_site %}
                                    {% for su in streaming_url %}
                                        {% if forloop.counter == forloop.parentloop.counter %}
                                            <button id="btn_streaming" name="btn_streaming" class="donate_submit" onclick="window.open('{{ su }}');">
                                                {{ forloop.counter }}.
                                                {% if ss == 'afreecatv' %}
                                                    아프리카tv(Afreecatv)
                                                {% elif ss == 'twitch' %}
                                                    트위치(Twitch)
                                                {% elif ss == 'youtube' %}
                                                    유튜브(Youtube)
                                                {% elif ss == 'kakaotv' %}
                                                    카카오tv(Kakaotv)
                                                {% else %}
                                                    기타
                                                {% endif %}
                                            </button>
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            <div class="modal fade" id="matchModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                            <h3 class="modal-title" id="lineModalLabel">매치 결과 제출</h3>
                        </div>
                        <form id="match_form" method="POST">{% csrf_token %}
                            <input type="hidden" class="form-control" id="purpose" name="purpose" value="match_update">
                            <input type="hidden" class="form-control" id="tournament_id" name="tournament_id" value="{{ tournament.id }}">
                            <input type="hidden" class="form-control" id="match_id" name="match_id" value="">
                            <div class="modal-body">
                                <!-- content goes here -->
                                <label for="exampleInputPassword1">매치의 승자를 선택해주세요.</label>
                                <div style="text-align: center;">
                                    {% if tournament.tournament_format == 'single_elimination' or tournament.tournament_format == 'double_elimination' %}
                                        <div class="btn-group" data-toggle="buttons" style="margin: 0 auto;">
                                            <label class="btn btn-default">
                                                <input required type="radio" id="input_player1_id" name="winner_id" autocomplete="off" value="">
                                                <span id="button_player1_id"></span>
                                            </label>
                                            <label class="btn btn-default">
                                                <input required type="radio" id="input_player2_id" name="winner_id" autocomplete="off" value="">
                                                <span id="button_player2_id"></span>
                                            </label>
                                        </div>
                                    {% else %}
                                        <div class="btn-group" data-toggle="buttons" style="margin: 0 auto;">
                                            <label class="btn btn-default">
                                                <input required type="radio" id="input_player1_id" name="winner_id" autocomplete="off" value="">
                                                <span id="button_player1_id"></span>
                                            </label>
                                            <label class="btn btn-default">
                                                <input required type="radio" name="winner_id" autocomplete="off" value="tie">
                                                <span>무승부</span>
                                            </label>
                                            <label class="btn btn-default">
                                                <input required type="radio" id="input_player2_id" name="winner_id" autocomplete="off" value="">
                                                <span id="button_player2_id"></span>
                                            </label>
                                        </div>
                                    {% endif %}
                                </div>
                                <br/>
                                <label for="exampleInputPassword1">매치 스코어를 입력해주세요.</label>
                                <div class="row" style="text-align: center;">
                                    <div class="input-group spinner_player1_score">
                                        <span class="input-group-addon" id="span_player1_id"></span>
                                        <input required style="text-align: right;" type="text" name="match_score1" class="form-control" value="0" aria-describedby="sizing-addon2">
                                        <div class="input-group-btn-vertical">
                                            <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                            <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                                        </div>
                                    </div>
                                    <span>vs.</span>
                                    <div class="input-group spinner_player2_score">
                                        <span class="input-group-addon" id="span_player2_id"></span>
                                        <input required style="text-align: right;" type="text" name="match_score2" class="form-control" value="0" aria-describedby="sizing-addon2">
                                        <div class="input-group-btn-vertical">
                                            <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
                                            <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <button type="submit" class="btn btn-primary center-block join_submit">매치 결과 제출</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block script %}
    <script>
        $(document).on("click", "#button_matchModal", function () {
            var player1_id = $(this).data('player1-id');
            var player1_username = $(this).data('player1-username');
            var player2_id = $(this).data('player2-id');
            var player2_username = $(this).data('player2-username');
            var match_id = $(this).data('match-id');
            $(".modal-body #button_player1_id").text(player1_username);
            $("#input_player1_id").val(player1_id);
            $(".modal-body #span_player1_id").text(player1_username);
            $(".modal-body #button_player2_id").text(player2_username);
            $("#input_player2_id").val(player2_id);
            $(".modal-body #span_player2_id").text(player2_username);

            $('#match_id').val(match_id);
        });

        /* input : 숫자만 입력이 가능하도록 */
        $("input[name=player1_score], input[name=player2_score]").keyup(function(event){
            if (!(event.keyCode >=37 && event.keyCode<=40)){
                var inputVal = $(this).val();
                $(this).val(inputVal.replace(/[^0-9]/gi,''));
            }
        });

        $('.spinner_player1_score .btn:first-of-type').on('click', function() {
            $('.spinner_player1_score input').val( parseInt($('.spinner_player1_score input').val(), 10) + 1);
        });
        $('.spinner_player1_score .btn:last-of-type').on('click', function() {
            $('.spinner_player1_score input').val( parseInt($('.spinner_player1_score input').val(), 10) - 1);
        });
        $('.spinner_player2_score .btn:first-of-type').on('click', function() {
            $('.spinner_player2_score input').val( parseInt($('.spinner_player2_score input').val(), 10) + 1);
        });
        $('.spinner_player2_score .btn:last-of-type').on('click', function() {
            $('.spinner_player2_score input').val( parseInt($('.spinner_player2_score input').val(), 10) - 1);
        });

        $("#match_form").submit(function(e) {
            e.preventDefault();
            serializedData = $("#match_form").serialize();
            $('#match_submit').text("결과 제출중");

            $.ajax({
                type: 'POST',
                url: '/t/{{ tournament.tournament_url }}/',
                data: serializedData,
                dataType: 'json',
                success: function(response) {
                    if(response.status == "success"){
                        alert('매치 결과가 정상적으로 제출되었습니다.');
                        location.reload();
                    }
                }
            });
        });

        $(document).ready(function(){
            {% if not request.user.is_authenticated %}
                $("#participation").click(function(){
                    alert("로그인이 필요한 기능입니다.");
                    location.href='{% url 'login' %}';
                });

                $("#funding").click(function(){
                    alert("로그인이 필요한 기능입니다.");
                    location.href='{% url 'login' %}';
                });
            {% endif %}

            $('.participation_checkin').click(function(e){
                if(confirm("대회에 체크인 하시겠습니까?")){
                    var serializedData = {
                        "purpose": "participation_checkin",
                        "tournament_id": '{{ tournament.id }}'
                    };
                    $.ajax({
                        type: 'POST',
                        url: '/t/{{ tournament.tournament_url }}/',
                        data: serializedData,
                        dataType: 'json',
                        success: function(response) {
                            if(response.status == "success"){
                                alert("정상적으로 체크인 되었습니다.");
                                location.reload();
                            }
                        }
                    });
                }
            });

            $('#challonge_start').click(function(e){
                if(confirm("대진표 기능을 시작하시겠습니까? 시작하실 경우 초기화 전까지 참가자를 추가하실 수 없으며, 대회 매치 승패 결과를 입력해주세요.")){
                    var serializedData = {
                        "purpose": "challonge_start",
                        "tournament_id": '{{ tournament.id }}'
                    };
                    $.ajax({
                        type: 'POST',
                        url: '/t/{{ tournament.tournament_url }}/',
                        data: serializedData,
                        dataType: 'json',
                        success: function(response) {
                            if(response.status == "success"){
                                location.reload();
                            }
                        }
                    });

                }
            });

            $('#challonge_reset').click(function(e){
                if(confirm("대진표 기능을 초기화시겠습니까? 초기화하실 경우 대진표가 다시 시작하게 됩니다.")){
                    var serializedData = {
                        "purpose": "challonge_restart",
                        "tournament_id": '{{ tournament.id }}'
                    };
                    $.ajax({
                        type: 'POST',
                        url: '/t/{{ tournament.tournament_url }}/',
                        data: serializedData,
                        dataType: 'json',
                        success: function(response) {
                            if(response.status == "success"){
                                location.reload();
                            }
                        }
                    });
                }
            });

            $('.participation_edit').click(function(){
                $(this).parents('tr').find('td.participation_edit_td').each(function() {
                    var html = $(this).html();
                    var input = $('<input class="form-control participation_edit_input" type="text"/>');
                    input.val(html);
                    $(this).html(input);
                });
                $(this).hide();
                $(this).parents('td').find('a.participation_save').show();
            });


            $('.participation_save').click(function(){
                var input_array = [];

                $(this).parents('tr').find('input.participation_edit_input').each(function() {
                    var html = $(this).val();
                    input_array.push(html);
                    $(this).parent('td').text(html);
                    $(this).remove();
                });

                var serializedData = {
                    "purpose": "participation_edit",
                    "participation_id": $(this).attr('name'),
                    "participation_input": input_array
                };

                $.ajax({
                    type: 'POST',
                    url: '/t/{{ tournament.tournament_url }}/',
                    data: serializedData,
                    dataType: 'json',
                    success: function(response) {

                    }
                });

                $(this).hide();
                $(this).parents('td').find('a.participation_edit').show();
            });

            $('.participation_delete').click(function(e){
                if(confirm("참가자 목록에서 삭제하시겠습니까?")){
                    var serializedData = {
                        "purpose": "participation_delete",
                        "participation_id": $(this).attr('name'),
                        "tournament_id": '{{ tournament.id }}'
                    };
                    $.ajax({
                        type: 'POST',
                        url: '/t/{{ tournament.tournament_url }}/',
                        data: serializedData,
                        dataType: 'json',
                        success: function(response) {
                            if(response.status == "success"){
                                location.reload();
                                // yes
                                $(this).parents('tr').remove();
                            }
                        }
                    });

                }
            });

            // 만약 금액 직접 입력을 선택하면 금액 항목이 팝업되도록
            $('#funding_amount').change(function() {
                $("#div_funding_amount_etc").hide();
                $("#funding_amount_etc").prop('disabled', true);

                if(document.getElementById('funding_amount').value=="etc"){
                    $("#div_funding_amount_etc").show();
                    $("#funding_amount_etc").prop('disabled', false);
                }
            });

            // 후원 금액 직접 입력 시
            $('.spinner_funding_amount .btn:first-of-type').on('click', function() {
                $('.spinner_funding_amount input').val( parseInt($('.spinner_funding_amount input').val(), 10) + 1000);
            });
            $('.spinner_funding_amount .btn:last-of-type').on('click', function() {
                $('.spinner_funding_amount input').val( parseInt($('.spinner_funding_amount input').val(), 10) - 1000);
            });

            $(".btn-pref .btn").click(function(){
                $(".btn-pref .btn").removeClass("btn-primary").addClass("btn-custom");
                // $(".tab").addClass("active"); // instead of this do the below
                $(this).removeClass("btn-custom").addClass("btn-primary");
            });

            /* hover-border-color-change */
            function mouseOver_div() {
                $(this).css("border-color", "#ff9900");
            }
            function mouseOut_div() {
                $(this).css("border-color", "#fff");
            }
            $('.hover_div').bind('mouseover', mouseOver_div).bind('mouseout', mouseOut_div);

            /* hover-border-color-change */
            function mouseOver_a() {
                $(this).css("background", "#ff9900");
                $(this).css("color", "#fff");
                $(this).css("border-color", "#ff9900");
            }
            function mouseOut_a() {
                $(this).css("background", "#1a1a1a");
                $(this).css("color", "#fff");
                $(this).css("border-color", "#fff");
            }
            $('.hover_a').bind('mouseover', mouseOver_a).bind('mouseout', mouseOut_a);

            /* free_board, participation_board click */
            $('#div_participation_board').hide();
            $('#div_video_board').hide();
            $('#free_board').click(function(){
                $('#div_free_board').show();
                $('#div_participation_board').hide();
                $('#div_video_board').hide();
                $(this).unbind('mouseover', mouseOver_a).unbind('mouseout', mouseOut_a);
                $('#participation_board').bind('mouseover', mouseOver_a).bind('mouseout', mouseOut_a);
                $('#participation_board').css("background-color", "#1a1a1a");
                $('#participation_board').css("color", "#fff");
                $('#participation_board').css("border-color", "#fff");
                $('#video_board').bind('mouseover', mouseOver_a).bind('mouseout', mouseOut_a);
                $('#video_board').css("background-color", "#1a1a1a");
                $('#video_board').css("color", "#fff");
                $('#video_board').css("border-color", "#fff");
            });
            $('#participation_board').click(function(){
                $('#div_free_board').hide();
                $('#div_participation_board').show();
                $('#div_video_board').hide();
                $(this).unbind('mouseover', mouseOver_a).unbind('mouseout', mouseOut_a);
                $('#free_board').bind('mouseover', mouseOver_a).bind('mouseout', mouseOut_a);
                $('#free_board').css("background-color", "#1a1a1a");
                $('#free_board').css("color", "#fff");
                $('#free_board').css("border-color", "#fff");
                $('#video_board').bind('mouseover', mouseOver_a).bind('mouseout', mouseOut_a);
                $('#video_board').css("background-color", "#1a1a1a");
                $('#video_board').css("color", "#fff");
                $('#video_board').css("border-color", "#fff");
            });
            $('#video_board').click(function(){
                $('#div_free_board').hide();
                $('#div_participation_board').hide();
                $('#div_video_board').show();
                $(this).unbind('mouseover', mouseOver_a).unbind('mouseout', mouseOut_a);
                $('#free_board').bind('mouseover', mouseOver_a).bind('mouseout', mouseOut_a);
                $('#free_board').css("background-color", "#1a1a1a");
                $('#free_board').css("color", "#fff");
                $('#free_board').css("border-color", "#fff");
                $('#participation_board').bind('mouseover', mouseOver_a).bind('mouseout', mouseOut_a);
                $('#participation_board').css("background-color", "#1a1a1a");
                $('#participation_board').css("color", "#fff");
                $('#participation_board').css("border-color", "#fff");
            });

            $("#funding_form").submit(function(e) {
                e.preventDefault();
                serializedData = $("#funding_form").serialize();
                var newWindow = window.open("","_blank");
                $.ajax({
                    type: 'POST',
                    url: '/t/{{ tournament.tournament_url }}/',
                    data: serializedData,
                    dataType: 'json',
                    success: function(response) {
                        newWindow.location.href = response.status;
                        newWindow.focus;
                    }
                });
            });

            $("#participation_form").submit(function(e) {
                e.preventDefault();
                var formData = new FormData(this);
                $('#participation_submit').text("참가 신청중");

                $.ajax({
                    type: 'POST',
                    url: '/t/{{ tournament.tournament_url }}/',
                    data: formData,
                    cache:false,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        if(response.status == "success"){
                            alert('참가자가 정상적으로 추가되었습니다.');
                            location.reload();
                        } else {
                            alert('이미 참가 신청되어 있습니다.');
                        }
                    }
                });
            });

            $("#participation_selfedit_form").submit(function(e) {
                e.preventDefault();
                var formData = new FormData(this);
                $('#participation_selfedit_submit').text("참가 신청중");

                $.ajax({
                    type: 'POST',
                    url: '/t/{{ tournament.tournament_url }}/',
                    data: formData,
                    cache:false,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        if(response.status == "success"){
                            alert('정상적으로 수정되었습니다.');
                            location.reload();
                        }
                    }
                });
            });

            $("#participationManual_form").submit(function(e) {
                e.preventDefault();
                var formData = new FormData(this);
                $('#participationManual_submit').text("참가 신청중");

                $.ajax({
                    type: 'POST',
                    url: '/t/{{ tournament.tournament_url }}/',
                    data: formData,
                    cache:false,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        if(response.status == "success"){
                            alert('참가자가 정상적으로 추가되었습니다.');
                            location.reload();
                        }
                    }
                });
            });

            $("#participationNo_form").submit(function(e) {
                e.preventDefault();
                serializedData = $("#participationNo_form").serialize();
                $('#participationNo_submit').text("참가 신청중");

                $.ajax({
                    type: 'POST',
                    url: '/t/{{ tournament.tournament_url }}/',
                    data: serializedData,
                    dataType: 'json',
                    success: function(response) {
                        if(response.status == "success"){
                            alert('참가자가 정상적으로 추가되었습니다.');
                            location.reload();
                        }
                    }
                });
            });

            /*
             var click_description = 0;
             $("#edit_description").click(function(e){
             if(click_description==0){
             // 클릭시 창 켜지기
             $('.summernote_description').summernote({focus: true});
             document.getElementById("edit_description").value="저장하기";
             click_description = 1;
             } else if(click_description==1){
             // 저장하기
             e.preventDefault();
             var serializedData = {
             "purpose": "description",
             "description": $('.summernote_description').summernote('code')
             };
             $.ajax({
             type: 'POST',
             url: '/t/{{ tournament.tournament_url }}/',
             data: serializedData,
             dataType: 'json',
             success: function(response) {
             $('.summernote_description').summernote('destroy');
             document.getElementById("edit_description").value="수정하기";
             click_description = 0;
             }
             });
             }
             });
             */

            var click_notice = 0;
            $("#edit_notice").click(function(e){
                if(click_notice==0){
                    /* 클릭시 창 켜지기 */
                    $('#summernote_notice').summernote();
                    $('#edit_notice').html('저장하기');
                    click_notice = 1;
                } else if(click_notice==1){
                    /* 저장하기 */
                    var serializedData = {
                        "purpose": "notice",
                        "tournament_id": "{{ tournament.id }}",
                        "notice": $('#summernote_notice').summernote('code')
                    };
                    $.ajax({
                        type: 'POST',
                        url: '/t/{{ tournament.tournament_url }}/',
                        data: serializedData,
                        dataType: 'json',
                        success: function(response) {
                            if(response.status == "success"){
                                $('#edit_notice').html('수정하기');
                                click_notice = 0;
                                $('#summernote_notice').summernote('destroy');
                            }
                        }
                    });
                }
            });

            $("#commenters").on("click", ".reply", function(){
                var form = $("#comment_form").clone(true);
                var parent_id = $(this).parent().parent().attr('id');
                form.find('.parent').val(parent_id);
                form.attr('class', parent_id);
                $(this).parent().append(form);
                $(this).parent().find('a').removeClass("reply").addClass("reply_clicked");
            });

            $("#commenters").on("click", ".reply_clicked", function(){
                var parent_id = $(this).parent().parent().attr('id');
                var form = document.getElementsByClassName(parent_id);
                $(form).remove();
                $(this).parent().find('a').removeClass("reply_clicked").addClass("reply");
            });

            $("#comment_form").submit(function(e) {
                e.preventDefault();
                serializedData = $("#comment_form").serialize();
                $.ajax({
                    type: 'POST',
                    url: '/t/{{ tournament.tournament_url }}/',
                    data: serializedData,
                    dataType: 'json',
                    success: function(data) {
                        alert('댓글이 등록되었습니다.');
                        location.reload();
                    }
                });
            });

            function currentDate(){
                var currentdate = new Date();
                var datetime = currentdate.getFullYear() + "/"
                        + (currentdate.getMonth()+1)  + "/"
                        + currentdate.getDate() + " "
                        + currentdate.getHours() + ":"
                        + currentdate.getMinutes();
                return datetime
            }

            $('#calendar').fullCalendar({
                lang : "ko",
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay,listWeek'
                },
                defaultDate: currentDate(),
                navLinks: true, // can click day/week names to navigate views
                eventLimit: true, // allow "more" link when too many events
                events: [
                    {
                        title: '대회 참가 신청 기간',
                        start: '{{ tournament.participation_starttime }}',
                        end: '{{ tournament.participation_endtime }}'
                    },
                    {
                        title: '대회 진행 일정 기간',
                        start: '{{ tournament.tournament_starttime }}',
                        end: '{{ tournament.tournament_endtime }}'
                    },
                ]
            });

        });
    </script>

    {% include 'main/functions/light-youtube-embed.html' %}
    <!-- include 'main/functions/jquery-chat-application.html' %} -->

    <script type="text/javascript" src="{% static 'js/moment.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/fullcalendar.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/ko.js' %}"></script>

    <!-- Go to www.addthis.com/dashboard to customize your tools -->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57d75e1fa49a7bd2"></script>

{% endblock %}